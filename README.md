# Dosimeter-SQUICK
Представляю вашему вниманию дозиметр-радиометр "писк". Дозиметр был разработан как давняя мечта, ещё с времён игры в сталкер.
Моей целью было разработать максимально дешёвое и надёжное устройство, и в дальнейшем отдать его на "растерзание публики".
Весь программный код доступен под лицензией MIT, то есть при редактировании должна быть ссылка на оригинал.
Дозиметр имеет 3 версии: simple, medium и max.
Ссылки на печатные платы в самом низу. На данный момент готова прошивка для medium и max. Не ругайте, код пишет один человек в свободное время.
## Начну с аппаратной части: 
  Каждая версия работает на своём микроконтроллере. simple на attiny85, medium на atmega328p-au, и max на atmega328p-mu.
  В весрии simple и medium за отображение информации отвечает 4х разрядный семисегментный индикатор с общим анодом, микросхема
  TM1637 и три светодиода отвечающие за диапазон (микро, милли и рентген). Доп светодиоды имеются только на medium версии,
  на версии simple индикация диапазона производится точками.
  Генерация высокого напряжения реализована на irf840, диоде HER106, конденсаторе и катушке индуктивности (Сопротивление ~5 Ом). 
  В общем обычный dc-dc с микроконтроллерным управлением.
  Чтение высокого напряжения реализовано на делителе 126.6МОм/470кОм.
  Снятие показаний происходит с помощью эмиттерного повторителя на кт315, и идёт на вход прерываний INT0.
  Что по питанию. По питанию использована микросхема ME2108A50PG, которая отвечает за повышение напряжения до 5 вольт, и зарядное устройство для литиевых аккумуляторов на tp4056. 
  Разъём Micro USB нужен число для зарядки устройства. Возможно потом, если публике хочется обновлять прошивку по юсб, а не через программатор, могу добавить и юарт.
  Возможно последняя версия будет на stm32, и поддерживать спутники но пока что это не точно
## Программная часть:
  Начну с того, что вам нужно иметь программатор для того чтобы прошить устройство. Программаторы перечислены в файле platformio.ini, где и нужно будет в дальнейшем выбирать каким образом прошивать. Сразу говорю, как ардуино прошить нельзя, программатор нужен обязательно.
  И так. Platformio это плагин для программы Visual Studio Code, который упрощает разработку под микроконтроллеры, следовательно нужно сначала скачать саму IDE, и после установки platformio открыть скачаный проект уже в программе. О том как работать с этой средой можно посмотреть на ютубе, по этому не буду углубляться, по сути это как в arduino ide, только удобнее.
  Сразу скажу, что отправной точкой проекта была эта статья: https://cxem.net/dozimetr/3-10.php
  Огромное спасибо автору, т.к. пока я разбирался в его коде, я начал больше понимать в регистрах avr.
  Программное обеспечение постепенно обновляется, и с каждой версией оно будет ещё более быстрым и энергоэффективным. Я не буду углубляться в алгоритм счёта, так как он уже приведён в выше указанной статье. Скажу только что работает он вполне сносно, и расхождение измерений с теми что были у пользователей на youtube не более 5% (Проверялось на хлориде калия).
  Плюсом самого устройства является то что в принципе можно подключить практически любой счётчик, питание которого не более 800 вольт, и время счёта не выше 100с, в настройках можно выбрать готовые пресеты, ии настроить свой.
  Все настройки хранятся в eeprom. При первом включении устанавливаются значения по умолчанию. По умолчанию это под счётчик сбм-20.
## Пользовательский интерфейс:
  Это довольно сложная часть, т.к. имея две кнопки и семисегментный дисплей было довольно сложно добавить удобное меню, но в итоге это исправлено в версии max.
  Давайте по порядку. Когда вы включаете устройство, оно переходит в первый режим, это режим поиск. Как понятно из названия, этот режим показывает текущий фон, и зависит от времени счёта. 
  Теперь к тому, что можно делать на экране выбранного режима (версия medium).
  -Долгое удержание кнопки reset сбрасывает показания.
  -Короткое нажатие кнопки reset показывает текущий режим.
  -Долгое нажатие кнопки set переводит устройство в спящий режим.
  -Короткое нажатие кнопки set на данном экране ничего не делает.
  -Удержание обеих кнопок переводит устройство в выбор режима.
  Навигация в меню следующая:
    -Долгое удержание кнопки reset выходит из меню.
    -Короткое нажатие кнопки reset предыдущий режим.
    -Долгое нажатие кнопки set выбрать режим.
    -Короткое нажатие кнопки set следующий режим.
  Для версии max
  -Удержание обеих кнопок входит в меню.
  -Перемещение по меню осуществляется коротким нажаниет на кнопку.
  -Выбор производится удержанием кнопки set.
  -Выход или отмена кнопкой reset.
  Для версии simple меню не предусмотрено.
  В кратце пробежимся по режимам:
  1. Первый режим background, то есть текущий фон. Показывает текущий фон в рентгенах.
  2. Второй режим измерение активности за промежуток времени.
  3. Третий режим число частиц за секунду.
  
  В версии simple присутсвует режим измерения фона, то есть он работает как сигнализатор.
  Версия medium на данный момент может практически тоже самое что и max, за исключением информативности дисплея. Там так же есть перемещение по меню, и те же режимы, но удобство использования страдает.
## Режим поиск:
  В режиме поиск показывается текущее значение фона, накопленная доза, заряд батареи, погрешность измерений, и график изменения зарегистрированого фона.
  По сути это всё что есть в данном режиме. Дополнительных опций не имеет.
## Режим измерения активности:
  При выборе этого режима откроется меню, где требуется установить время замера в минутах, и число шагов. 
  Этот режим является попыткой скопировать похожую опцию с дозиметра "Припять", и как я считаю довольно успешная.
  Этот режим пожно использовать так. Первый замер фиксирует число частиц фона, а второй фиксирует число частиц от измеряемого объекта.
  Т.к. режим универсален, можно проводить сначала измерения бетта+гамма, а потом поставить бетта фильтр и второй раз измерить с ним.
  В этом режиме удержание кнопки reset начинает замер с самого начала. Так же после завершения первого замера требуется нажать кнопку set, чтобы начать измерять образец.
## Режим секунда:
  В этом режиме выводится число частиц, которые в течении секунды попали в счётчик. Данный режим как и первый не имеет дополнительных опций.
  В левой части выводится число частиц зафиксированных в данную секунду, а справа максимум частиц за секунду
## Будет добавлено:
  -Выбор типа прибора в configuration.h (Их на данный момент 3)
  -Построение графика в режиме секундного замера
  -Защита от переразряда аккумулятора (Программная)
## Уже добавлено:
  -Как русский, так и английский язык (Выбилается в configuration.h)
  -Сохранение накопленой дозы в памяти
  -Тонкая настройка счётчика.
  -Расчёт погрешности измерения.
  -Режим измерения активности образца (Почти как у припяти)
  -Режим измерения частиц за секунду
  -Готовые пресеты популярных счётчиков
  -Построение графиков фона
  -Увеличенная энергоэффективность
  -Улучшеная скорость работы.
Проект полностью открыт, можете заказывать печатную плату на jlcpcb.
Если хотите поддержать разработчика вот мой киви: +79525500562 или webmoney: R530142330941
Версия simple: https://easyeda.com/AdamFull/geigercounter_simple
Версия medium: https://easyeda.com/AdamFull/geigercounter
Версия    max: https://easyeda.com/AdamFull/geigercounter_nokia
